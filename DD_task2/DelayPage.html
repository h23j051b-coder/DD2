{% extends "global/Page.html" %}
{% load otree %}

{% block title %}
    選択課題（{{ delay }}）
{% endblock %}

{% block content %}

<p><b>以下はあなたが1日目に作成したエピソードです。このエピソードを読み，もう一度情景を思い浮かべてから下記の問いに臨んでください。</b></p>

<p><b>● 選択した目標</b><br>
{% if group == "関連" %}
    {{ delay }} に {{ eft_goal }} を達成して <b>{{ delayed_reward_str }}円</b>を獲得する
{% else %}
    あなたは {{ delay }} に <b>{{ eft_goal }}</b> という目標を達成できる
{% endif %}
</p>

<p><b>● 5W1H での記述</b><br>
    {{ eft_5w1h }}
</p>

<p><b>● 感情の記述</b><br>
    {{ eft_emotion }}
</p>

<hr>

<p>
以下のうち、あなたがより望ましいと思う方をそれぞれ選んでください。
問いによって「今」や「明日」といった報酬獲得時点と「100円」といった報酬量の組み合わせが変化するため，注意して回答してください。
</p>

<style>
.option-card {
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 16px;
    background: #fdfdfd;
}
.option-or {
    padding: 0 12px;
    font-weight: bold;
}
.option-card input[type="radio"] {
    margin-right: 8px;
}
</style>

<form method="post">
    {% csrf_token %}

    {% for amount, amount_str in amount_pairs %}
        <div class="option-card">
            <label>
                <input type="radio" name="choice_{{ forloop.counter }}" value="immediate">
                今 {{ amount_str }}円もらう
            </label>
            <span class="option-or">　または　</span>
            <label>
                <input type="radio" name="choice_{{ forloop.counter }}" value="delayed">
                {{ delay }} に {{ delayed_reward_str }}円もらう
            </label>
        </div>
    {% endfor %}

    <input type="hidden" name="choice_data" id="choice_data">

    <button class="otree-btn-next btn btn-primary">次へ</button>
</form>

<script>
document.querySelector('form').addEventListener('submit', function(e) {
    const choices = [];
    let missing = false;
    const total = {{ amount_pairs|length }};
    for (let i = 1; i <= total; i++) {
        const val = document.querySelector(`input[name="choice_${i}"]:checked`);
        if (!val) {
            missing = true;
        }
        choices.push(val ? val.value : null);
    }
    if (missing) {
        alert('すべての選択肢を選んでから次へ進んでください。');
        e.preventDefault();
        return;
    }
    document.getElementById('choice_data').value = JSON.stringify(choices);
});
</script>

{% endblock %}
