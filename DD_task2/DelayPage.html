{% extends "global/Page.html" %}
{% load otree %}

{% block title %}
    選択課題（{{ delay }}）
{% endblock %}

{% block content %}

<style>
.delay-card {
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 16px;
    background: #fdfdfd;
}
.delay-title { font-weight: bold; margin-bottom: 8px; }
.choice-row { display: flex; justify-content: space-between; margin-top: 6px; }
.choice-label { display: flex; align-items: center; }

.otree-btn-next, .otree-btn-submit {
    display: none !important;
}
</style>

<p>
以下はあなたが選択する問題です。<br>
全ての項目に回答し、最後に「回答を確定して次へ」を押してください。
</p>

<form id="choiceForm" method="post">
    <input type="hidden" name="choice_data" id="choice_data">

    {% for num, amount in amounts %}
        <div class="delay-card">
            <div class="delay-title">
                {{ forloop.counter }}. 
                <span style="color:#333">
                    今すぐ {{ amount }}円  ＜または＞  {{ delay }}後に 10,000円
                </span>
            </div>

            <div class="choice-row">
                <label class="choice-label">
                    <input type="radio" name="choice_{{ forloop.counter }}" value="immediate">
                    今すぐ {{ amount }}円
                </label>

                <label class="choice-label">
                    <input type="radio" name="choice_{{ forloop.counter }}" value="delay">
                    {{ delay }}後に 10,000円
                </label>
            </div>
        </div>
    {% endfor %}

    <button type="button"
        onclick="submitChoices()"
        class="btn btn-primary"
        style="width:100%;font-size:1.1em;padding:12px;margin-top:12px">
        回答を確定して次へ
    </button>

</form>

<script>
function submitChoices(){
    const amounts = {{ amounts|json }};
    const choices = [];
    let missing = false;

    for (let i = 1; i <= amounts.length; i++) {
        const val = document.querySelector(`input[name="choice_${i}"]:checked`);
        if (!val) {
            missing = true;
        }
        choices.push(val ? val.value : null);
    }

    if (missing) {
        alert('すべての選択肢を選んでから次へ進んでください。');
        return;
    }

    document.getElementById('choice_data').value =
        JSON.stringify({ amounts, choices });

    document.getElementById('choiceForm').submit();
}
</script>

{% endblock %}
